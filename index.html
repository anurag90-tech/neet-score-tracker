<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NEET Progress Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f7fa;
      padding: 20px;
      max-width: 900px;
      margin: auto;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
    }
    form, .stats, .dashboard, .buttons {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    input {
      padding: 10px;
      margin: 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      width: calc(100% - 24px);
    }
    button {
      padding: 10px 20px;
      margin: 5px;
      border: none;
      border-radius: 8px;
      background: #3498db;
      color: #fff;
      cursor: pointer;
    }
    button:hover { background: #2980b9; }
    canvas {
      margin: 20px 0;
      background: #fff;
      border-radius: 12px;
      padding: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>

<h1>üìä NEET Progress Tracker</h1>

<form id="scoreForm">
  <input type="text" id="testName" placeholder="Test Name (e.g. Major Test 1)">
  <input type="date" id="testDate">
  <input type="number" id="physics" placeholder="Physics (out of 180)" required>
  <input type="number" id="chemistry" placeholder="Chemistry (out of 180)" required>
  <input type="number" id="biology" placeholder="Biology (out of 360)" required>
  <input type="number" id="batchRank" placeholder="Batch Rank" required>
  <input type="number" id="batchTotal" placeholder="Total in Batch" required>
  <input type="number" id="campusRank" placeholder="Campus Rank" required>
  <input type="number" id="campusTotal" placeholder="Total in Campus" required>
  <button type="submit">Add Test</button>
</form>

<div class="stats">
  <h3>üìå Latest Test Stats</h3>
  <p id="latestStats">No data yet</p>
</div>

<div class="dashboard">
  <h3>üìà Performance Dashboard</h3>
  <p id="dashboardStats">No data yet</p>
</div>

<div class="buttons">
  <button onclick="exportCSV()">‚¨áÔ∏è Export CSV</button>
  <button onclick="exportExcel()">‚¨áÔ∏è Export Excel</button>
  <button style="background:#e74c3c" onclick="resetData()">üóë Reset Data</button>
</div>

<canvas id="totalChart"></canvas>
<canvas id="physicsChart"></canvas>
<canvas id="chemistryChart"></canvas>
<canvas id="biologyChart"></canvas>

<script>
  let tests = JSON.parse(localStorage.getItem("neetTests")) || [];

  const totalCtx = document.getElementById("totalChart").getContext("2d");
  const physicsCtx = document.getElementById("physicsChart").getContext("2d");
  const chemistryCtx = document.getElementById("chemistryChart").getContext("2d");
  const biologyCtx = document.getElementById("biologyChart").getContext("2d");

  let totalChart, physicsChart, chemistryChart, biologyChart;

  function updateCharts() {
    const labels = tests.map((t, i) => t.name || `Test ${i+1}`);
    const totalScores = tests.map(t => t.total);
    const physicsScores = tests.map(t => t.physics);
    const chemistryScores = tests.map(t => t.chemistry);
    const biologyScores = tests.map(t => t.biology);

    if (totalChart) totalChart.destroy();
    if (physicsChart) physicsChart.destroy();
    if (chemistryChart) chemistryChart.destroy();
    if (biologyChart) biologyChart.destroy();

    totalChart = new Chart(totalCtx, {
      type: "line",
      data: {
        labels,
        datasets: [{
          label: "Total Score (720)",
          data: totalScores,
          borderColor: "blue",
          fill: false
        }]
      }
    });

    physicsChart = new Chart(physicsCtx, {
      type: "line",
      data: {
        labels,
        datasets: [{
          label: "Physics (180)",
          data: physicsScores,
          borderColor: "red",
          fill: false
        }]
      }
    });

    chemistryChart = new Chart(chemistryCtx, {
      type: "line",
      data: {
        labels,
        datasets: [{
          label: "Chemistry (180)",
          data: chemistryScores,
          borderColor: "green",
          fill: false
        }]
      }
    });

    biologyChart = new Chart(biologyCtx, {
      type: "line",
      data: {
        labels,
        datasets: [{
          label: "Biology (360)",
          data: biologyScores,
          borderColor: "purple",
          fill: false
        }]
      }
    });
  }

  function updateStats() {
    if (tests.length === 0) return;
    const last = tests[tests.length - 1];
    const percentage = ((last.total / 720) * 100).toFixed(2);
    const batchPercentile = (((last.batchTotal - last.batchRank) / last.batchTotal) * 100).toFixed(2);
    const campusPercentile = (((last.campusTotal - last.campusRank) / last.campusTotal) * 100).toFixed(2);

    document.getElementById("latestStats").innerHTML = `
      <b>${last.name || "Test " + tests.length}</b> (${last.date || "No Date"})<br>
      Total: <b>${last.total}/720</b> (${percentage}%)<br>
      Physics: ${last.physics}/180 | Chemistry: ${last.chemistry}/180 | Biology: ${last.biology}/360 <br>
      Batch Rank: ${last.batchRank}/${last.batchTotal} ‚Üí Percentile: ${batchPercentile}%<br>
      Campus Rank: ${last.campusRank}/${last.campusTotal} ‚Üí Percentile: ${campusPercentile}%
    `;
  }

  function updateDashboard() {
    if (tests.length === 0) return;
    const avg = arr => (arr.reduce((a,b)=>a+b,0)/arr.length).toFixed(2);
    const best = arr => Math.max(...arr);

    const avgPhysics = avg(tests.map(t=>t.physics));
    const avgChemistry = avg(tests.map(t=>t.chemistry));
    const avgBiology = avg(tests.map(t=>t.biology));
    const avgTotal = avg(tests.map(t=>t.total));

    const bestPhysics = best(tests.map(t=>t.physics));
    const bestChemistry = best(tests.map(t=>t.chemistry));
    const bestBiology = best(tests.map(t=>t.biology));
    const bestTotal = best(tests.map(t=>t.total));

    document.getElementById("dashboardStats").innerHTML = `
      <b>Average Scores:</b><br>
      Physics: ${avgPhysics}/180 | Chemistry: ${avgChemistry}/180 | Biology: ${avgBiology}/360 | Total: ${avgTotal}/720 <br><br>
      <b>Best Scores:</b><br>
      Physics: ${bestPhysics}/180 | Chemistry: ${bestChemistry}/180 | Biology: ${bestBiology}/360 | Total: ${bestTotal}/720
    `;
  }

  function exportCSV() {
    if (tests.length === 0) return alert("No data to export");
    let csv = "Test,Date,Physics,Chemistry,Biology,Total,Batch Rank/Total,Campus Rank/Total\n";
    tests.forEach((t,i)=>{
      csv += `${t.name || "Test " + (i+1)},${t.date || ""},${t.physics},${t.chemistry},${t.biology},${t.total},${t.batchRank}/${t.batchTotal},${t.campusRank}/${t.campusTotal}\n`;
    });
    let blob = new Blob([csv], {type:"text/csv"});
    let link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "neet_progress.csv";
    link.click();
  }

  function exportExcel() {
    if (tests.length === 0) return alert("No data to export");
    let table = [["Test","Date","Physics","Chemistry","Biology","Total","Batch Rank/Total","Campus Rank/Total"]];
    tests.forEach((t,i)=>{
      table.push([t.name || "Test " + (i+1), t.date || "", t.physics,t.chemistry,t.biology,t.total,`${t.batchRank}/${t.batchTotal}`,`${t.campusRank}/${t.campusTotal}`]);
    });
    let csv = table.map(row => row.join("\t")).join("\n");
    let blob = new Blob([csv], {type:"application/vnd.ms-excel"});
    let link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "neet_progress.xls";
    link.click();
  }

  function resetData() {
    if (confirm("‚ö†Ô∏è Are you sure you want to reset all data?")) {
      localStorage.removeItem("neetTests");
      tests = [];
      updateCharts();
      document.getElementById("latestStats").innerText = "No data yet";
      document.getElementById("dashboardStats").innerText = "No data yet";
    }
  }

  document.getElementById("scoreForm").addEventListener("submit", function(e) {
    e.preventDefault();

    const name = document.getElementById("testName").value.trim();
    const date = document.getElementById("testDate").value;
    const physics = parseInt(document.getElementById("physics").value);
    const chemistry = parseInt(document.getElementById("chemistry").value);
    const biology = parseInt(document.getElementById("biology").value);
    const batchRank = parseInt(document.getElementById("batchRank").value);
    const batchTotal = parseInt(document.getElementById("batchTotal").value);
    const campusRank = parseInt(document.getElementById("campusRank").value);
    const campusTotal = parseInt(document.getElementById("campusTotal").value);

    const total = physics + chemistry + biology;

    tests.push({ name, date, physics, chemistry, biology, total, batchRank, batchTotal, campusRank, campusTotal });
    localStorage.setItem("neetTests", JSON.stringify(tests));

    updateCharts();
    updateStats();
    updateDashboard();
    e.target.reset();
  });

  // Load saved data
  updateCharts();
  updateStats();
  updateDashboard();
</script>

</body>
</html>
